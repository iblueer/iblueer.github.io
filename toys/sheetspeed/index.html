    <html lang="zh-CN"><head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Sheetspeed - 表格处理工具</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" rel="stylesheet">
        <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.8/dist/chart.umd.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/marked@4.2.12/marked.min.js"></script>
        
        <!-- 配置Tailwind -->
        <script>
            tailwind.config = {
                theme: {
                    extend: {
                        colors: {
                            primary: '#165DFF',
                            secondary: '#FF7D00',
                            neutral: '#F5F7FA',
                            dark: '#1D2129',
                        },
                        fontFamily: {
                            inter: ['Inter', 'system-ui', 'sans-serif'],
                        },
                    }
                }
            }
        </script>
        
        <style type="text/tailwindcss">
            @layer utilities {
                .content-auto {
                    content-visibility: auto;
                }
                .card-shadow {
                    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
                }
                .hover-scale {
                    transition: transform 0.3s ease;
                }
                .hover-scale:hover {
                    transform: scale(1.02);
                }
                .progress-bar {
                    transition: width 0.5s ease;
                }
                .editor-focus {
                    @apply border-primary ring-2 ring-primary/20;
                }
                .btn-active {
                    @apply bg-primary/10 text-primary;
                }
            }
        </style>
    </head>
    <body class="font-inter bg-gray-50 text-dark min-h-screen flex flex-col">
        <!-- 导航栏 -->
        <nav class="bg-white shadow-sm sticky top-0 z-50 transition-all duration-300" id="navbar">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between h-16">
                    <div class="flex items-center">
                        <div class="flex-shrink-0 flex items-center">
                            <i class="fa-solid fa-table text-primary text-2xl mr-2"></i>
                            <span class="text-xl font-semibold">Sheetspeed</span>
                        </div>
                        <div class="hidden sm:ml-6 sm:flex space-x-8">
                            <a href="#editor" class="text-gray-700 hover:text-primary px-3 py-2 text-sm font-medium transition-colors duration-200">编辑</a>
                            <a href="#visualization" class="text-gray-700 hover:text-primary px-3 py-2 text-sm font-medium transition-colors duration-200">可视化</a>
                            <a href="#download" class="text-gray-700 hover:text-primary px-3 py-2 text-sm font-medium transition-colors duration-200">导出</a>
                        </div>
                    </div>
                </div>
            </div>
        </nav>

        <!-- 主内容区 -->
        <main class="flex-grow container mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <!-- 欢迎信息 -->
            <section class="mb-10">
                <h1 class="text-[clamp(1.75rem,3vw,2.5rem)] font-bold text-gray-900 mb-2">Sheetspeed</h1>
                <p class="text-gray-600 max-w-3xl">强大的表格处理工具，支持Markdown表格编辑、预览、可视化和导出。</p>
            </section>

            <!-- 编辑器区域 -->
            <section id="editor" class="mb-12">
                <div class="bg-white rounded-xl p-6 shadow-lg hover:shadow-xl transition-shadow duration-300">
                    <div class="flex flex-col sm:flex-row sm:items-center justify-between mb-4">
                        <h2 class="text-xl font-semibold flex items-center">
                            <i class="fa-solid fa-edit text-primary mr-2"></i> Markdown表格编辑器
                        </h2>
                        <div class="flex mt-3 sm:mt-0">
                            <button id="example-btn" class="px-4 py-2 bg-gray-100 text-gray-700 rounded-l-md hover:bg-gray-200 transition-colors duration-200 flex items-center">
                                <i class="fa-solid fa-lightbulb mr-1"></i> 示例
                            </button>
                            <button id="clear-btn" class="px-4 py-2 bg-gray-100 text-gray-700 border-l border-gray-200 hover:bg-gray-200 transition-colors duration-200 flex items-center">
                                <i class="fa-solid fa-eraser mr-1"></i> 清空
                            </button>
                            <button id="help-btn" class="px-4 py-2 bg-gray-100 text-gray-700 rounded-r-md border-l border-gray-200 hover:bg-gray-200 transition-colors duration-200 flex items-center">
                                <i class="fa-solid fa-question mr-1"></i> 帮助
                            </button>
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <p class="text-sm text-gray-500 mb-2">输入Markdown表格（使用 | 分隔单元格，第一行为表头）</p>
                        <div class="relative">
                            <textarea id="markdown-input" class="w-full h-64 p-4 border border-gray-300 rounded-lg focus:outline-none focus:editor-focus transition-all duration-200 resize-none" placeholder="| 姓名 | 年龄 | 职业 |&#10;|------|------|------|&#10;| 张三 | 28   | 工程师 |&#10;| 李四 | 32   | 设计师 |"></textarea>
                            <div class="absolute bottom-3 right-3 text-xs text-gray-400" id="char-count">0 字符</div>
                        </div>
                    </div>
                    
                    <div class="flex justify-between mb-6">
                        <div class="flex items-center">
                            <input type="checkbox" id="auto-preview" class="h-4 w-4 text-primary focus:ring-primary/50 border-gray-300 rounded" checked>
                            <label for="auto-preview" class="ml-2 block text-sm text-gray-700">自动预览</label>
                        </div>
                        <button id="preview-btn" class="px-6 py-3 bg-primary text-white rounded-md hover:bg-primary/90 transition-colors duration-200 shadow-sm flex items-center">
                            <i class="fa-solid fa-eye mr-2"></i> 预览表格
                        </button>
                    </div>
                    
                    <div id="preview-container" class="min-h-[200px] bg-gray-50 rounded-lg p-4 overflow-x-auto">
                        <div id="table-preview" class="opacity-100 text-center py-16">
                            <i class="fa-solid fa-table text-4xl text-gray-300 mb-2"></i>
                            <p class="text-gray-400">在此处预览您的表格</p>
                        </div>
                    </div>
                    
                    <div class="mt-4 flex justify-between items-center">
                        <div class="text-sm text-gray-500">
                            <span id="rows-count">0</span> 行 <span id="cols-count">0</span> 列
                        </div>

                    </div>
                </div>
            </section>

            <!-- 可视化区域 -->
            <section id="visualization" class="mb-12">
                <div class="bg-white rounded-xl p-6 shadow-lg hover:shadow-xl transition-shadow duration-300">
                    <h2 class="text-xl font-semibold mb-4 flex items-center">
                        <i class="fa-solid fa-chart-pie text-primary mr-2"></i> 数据可视化
                    </h2>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <!-- 图表类型选择 -->
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <h3 class="font-medium mb-3">图表类型</h3>
                            <div class="space-y-2" id="chart-types">
                                <div class="flex items-center p-2 rounded hover:bg-gray-100 cursor-pointer transition-colors duration-200 chart-type-option" data-type="bar">
                                    <i class="fa-solid fa-chart-bar text-primary mr-2"></i>
                                    <span>柱状图</span>
                                </div>
                                <div class="flex items-center p-2 rounded hover:bg-gray-100 cursor-pointer transition-colors duration-200 chart-type-option" data-type="line">
                                    <i class="fa-solid fa-chart-line text-primary mr-2"></i>
                                    <span>折线图</span>
                                </div>
                                <div class="flex items-center p-2 rounded hover:bg-gray-100 cursor-pointer transition-colors duration-200 chart-type-option" data-type="pie">
                                    <i class="fa-solid fa-chart-pie text-primary mr-2"></i>
                                    <span>饼图</span>
                                </div>
                                <div class="flex items-center p-2 rounded hover:bg-gray-100 cursor-pointer transition-colors duration-200 chart-type-option" data-type="doughnut">
                                    <i class="fa-solid fa-circle text-primary mr-2"></i>
                                    <span>环形图</span>
                                </div>
                                <div class="flex items-center p-2 rounded hover:bg-gray-100 cursor-pointer transition-colors duration-200 chart-type-option" data-type="radar">
                                    <i class="fa-solid fa-satellite-dish text-primary mr-2"></i>
                                    <span>雷达图</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 数据列选择 -->
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <h3 class="font-medium mb-3">数据列</h3>
                            <div id="column-selectors" class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">X轴/类别</label>
                                    <select id="x-axis-select" class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-primary/50 focus:border-primary transition-colors duration-200">
                                        <option value="">请选择...</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Y轴/数值</label>
                                    <select id="y-axis-select" class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-primary/50 focus:border-primary transition-colors duration-200">
                                        <option value="">请选择...</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 图表选项 -->
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <h3 class="font-medium mb-3">图表选项</h3>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">图表标题</label>
                                    <input type="text" id="chart-title" class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-primary/50 focus:border-primary transition-colors duration-200" placeholder="请输入图表标题">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">颜色主题</label>
                                    <div class="grid grid-cols-3 gap-2">
                                        <button class="theme-btn h-8 rounded-md bg-blue-500 ring-2 ring-offset-2 ring-primary" data-theme="blue"></button>
                                        <button class="theme-btn h-8 rounded-md bg-green-500" data-theme="green"></button>
                                        <button class="theme-btn h-8 rounded-md bg-purple-500" data-theme="purple"></button>
                                        <button class="theme-btn h-8 rounded-md bg-red-500" data-theme="red"></button>
                                        <button class="theme-btn h-8 rounded-md bg-yellow-500" data-theme="yellow"></button>
                                        <button class="theme-btn h-8 rounded-md bg-gray-500" data-theme="gray"></button>
                                    </div>
                                </div>
                                <div class="flex items-center">
                                    <input type="checkbox" id="show-legend" class="h-4 w-4 text-primary focus:ring-primary/50 border-gray-300 rounded" checked>
                                    <label for="show-legend" class="ml-2 block text-sm text-gray-700">显示图例</label>
                                </div>
                                <div class="flex items-center">
                                    <input type="checkbox" id="show-grid" class="h-4 w-4 text-primary focus:ring-primary/50 border-gray-300 rounded" checked>
                                    <label for="show-grid" class="ml-2 block text-sm text-gray-700">显示网格线</label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="mt-6 flex justify-center mb-6">
                        <button id="visualize-btn" class="px-6 py-3 bg-primary text-white rounded-md hover:bg-primary/90 transition-colors duration-200 shadow-sm flex items-center">
                            <i class="fa-solid fa-chart-bar mr-2"></i> 数据可视化
                        </button>
                    </div>
                    <div id="chart-container" class="hidden relative h-96 bg-gray-50 rounded-lg">
                        <canvas id="chart-canvas"></canvas>
                    </div>
                    
                    <div id="no-chart-message" class="h-96 flex items-center justify-center text-gray-400">
                        <div class="text-center">
                            <i class="fa-solid fa-chart-line text-5xl mb-4"></i>
                            <p>预览表格并选择数据列后将在此处显示图表</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 下载区域 -->
            <section id="download" class="mb-12">
                <div class="bg-white rounded-xl p-6 shadow-lg hover:shadow-xl transition-shadow duration-300">
                    <h2 class="text-xl font-semibold mb-4 flex items-center">
                        <i class="fa-solid fa-download text-primary mr-2"></i> 导出数据
                    </h2>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- 导出格式 -->
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <h3 class="font-medium mb-3">导出格式</h3>
                            <div class="space-y-2">
                                <div class="flex items-center p-2 rounded hover:bg-gray-100 cursor-pointer transition-colors duration-200 export-option btn-active" data-format="xlsx">
                                    <i class="fa-solid fa-file-excel text-primary mr-2"></i>
                                    <span>Excel (.xlsx)</span>
                                </div>
                                <div class="flex items-center p-2 rounded hover:bg-gray-100 cursor-pointer transition-colors duration-200 export-option" data-format="csv">
                                    <i class="fa-solid fa-file-csv text-primary mr-2"></i>
                                    <span>CSV (.csv)</span>
                                </div>
                                <div class="flex items-center p-2 rounded hover:bg-gray-100 cursor-pointer transition-colors duration-200 export-option" data-format="markdown">
                                    <i class="fa-solid fa-file-alt text-primary mr-2"></i>
                                    <span>Markdown (.md)</span>
                                </div>
                                <div class="flex items-center p-2 rounded hover:bg-gray-100 cursor-pointer transition-colors duration-200 export-option" data-format="json">
                                    <i class="fa-solid fa-file-code text-primary mr-2"></i>
                                    <span>JSON (.json)</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 导出选项 -->
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <h3 class="font-medium mb-3">导出选项</h3>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">文件名</label>
                                    <input type="text" id="export-filename" class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-primary/50 focus:border-primary transition-colors duration-200" value="table-data">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">包含选项</label>
                                    <div class="flex items-center">
                                        <input type="checkbox" id="include-header" class="h-4 w-4 text-primary focus:ring-primary/50 border-gray-300 rounded" checked>
                                        <label for="include-header" class="ml-2 block text-sm text-gray-700">包含表头</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-6 flex justify-center">
                        <button id="export-btn" class="px-6 py-3 bg-primary text-white rounded-md hover:bg-primary/90 transition-colors duration-200 shadow-sm flex items-center">
                            <i class="fa-solid fa-download mr-2"></i> 导出文件
                        </button>
                    </div>
                </div>
            </section>
        </main>

        <!-- 页脚 -->
        <footer class="bg-white border-t border-gray-200">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-8">
                <div class="flex flex-col md:flex-row justify-between items-center">
                    <div class="mb-4 md:mb-0">
                        <div class="flex items-center">
                            <i class="fa-solid fa-table text-primary text-xl mr-2"></i>
                            <span class="text-lg font-semibold">Sheetspeed</span>
                        </div>
                        <p class="text-gray-500 text-sm mt-1">强大的表格处理工具</p>
                    </div>
                    
                    <div class="flex space-x-6">
                        <a href="#" class="text-gray-500 hover:text-primary transition-colors duration-200">
                            <i class="fa-brands fa-github text-xl"></i>
                        </a>
                        <a href="#" class="text-gray-500 hover:text-primary transition-colors duration-200">
                            <i class="fa-brands fa-twitter text-xl"></i>
                        </a>
                        <a href="#" class="text-gray-500 hover:text-primary transition-colors duration-200">
                            <i class="fa-brands fa-linkedin text-xl"></i>
                        </a>
                    </div>
                </div>
                
                <div class="mt-8 pt-8 border-t border-gray-200 flex flex-col md:flex-row justify-between items-center">
                    <p class="text-gray-500 text-sm">© 2025 Sheetspeed. 保留所有权利。</p>
                    
                    <div class="mt-4 md:mt-0 flex space-x-6">
                        <a href="#" class="text-gray-500 hover:text-primary text-sm transition-colors duration-200">隐私政策</a>
                        <a href="#" class="text-gray-500 hover:text-primary text-sm transition-colors duration-200">使用条款</a>
                        <a href="#" class="text-gray-500 hover:text-primary text-sm transition-colors duration-200">联系我们</a>
                    </div>
                </div>
            </div>
        </footer>

        <!-- 帮助模态框 -->
        <div id="help-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
            <div class="bg-white rounded-xl p-6 max-w-2xl w-full max-h-[80vh] overflow-y-auto">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-semibold">Markdown表格语法帮助</h3>
                    <button id="close-help" class="text-gray-400 hover:text-gray-600">
                        <i class="fa-solid fa-times"></i>
                    </button>
                </div>
                <div class="prose max-w-none">
                    <h4>基本语法</h4>
                    <p>Markdown表格使用管道符号（|）分隔单元格，使用连字符（-）分隔表头和内容，使用冒号（:）定义对齐方式。</p>
                    <pre class="bg-gray-100 p-3 rounded-md text-sm overflow-x-auto">
| 姓名   | 年龄 | 职业   |
|--------|------|--------|
| 张三   | 28   | 工程师 |
| 李四   | 32   | 设计师 |
| 王五   | 45   | 产品经理 |</pre>
                    
                    <h4>对齐方式</h4>
                    <p>可以使用冒号定义单元格内容的对齐方式：</p>
                    <pre class="bg-gray-100 p-3 rounded-md text-sm overflow-x-auto">
| 左对齐   | 居中对齐 | 右对齐   |
|----------|:--------:|---------:|
| 内容     | 内容     | 内容     |
| 长文本内容 | 长文本内容 | 长文本内容 |</pre>
                    
                    <h4>特殊字符</h4>
                    <p>如果需要在表格中使用管道符号（|），可以使用HTML实体 <code>&amp;#124;</code> 替代。</p>
                    
                    <h4>示例</h4>
                    <p>以下是一个更复杂的示例：</p>
                    <pre class="bg-gray-100 p-3 rounded-md text-sm overflow-x-auto">
| 产品   | 价格（元） | 销量 | 增长率 |
|--------|------------|------|--------|
| 产品A  | 199        | 1200 | 12.5%  |
| 产品B  | 299        | 850  | 8.3%   |
| 产品C  | 399        | 520  | 15.7%  |</pre>
                </div>
            </div>
        </div>

        <!-- 通知组件 -->
        <div id="notification" class="fixed top-4 right-4 p-4 rounded-lg shadow-lg transform transition-all duration-300 translate-x-full opacity-0 z-50 flex items-center">
            <i id="notification-icon" class="mr-2"></i>
            <span id="notification-message"></span>
            <button class="ml-4 text-gray-400 hover:text-gray-600">
                <i class="fa-solid fa-times"></i>
            </button>
        </div>

        <script>
            // 全局变量
            let tableData = null;
            let chart = null;
            let selectedTheme = 'blue';
            
            // DOM 元素
            const markdownInput = document.getElementById('markdown-input');
            const charCount = document.getElementById('char-count');
            const autoPreview = document.getElementById('auto-preview');
            const previewBtn = document.getElementById('preview-btn');
            const tablePreview = document.getElementById('table-preview');
            const rowsCount = document.getElementById('rows-count');
            const colsCount = document.getElementById('cols-count');
            const visualizeBtn = document.getElementById('visualize-btn');
            const chartContainer = document.getElementById('chart-container');
            const chartCanvas = document.getElementById('chart-canvas');
            const noChartMessage = document.getElementById('no-chart-message');
            const xAxisSelect = document.getElementById('x-axis-select');
            const yAxisSelect = document.getElementById('y-axis-select');
            const chartTitle = document.getElementById('chart-title');
            const showLegend = document.getElementById('show-legend');
            const showGrid = document.getElementById('show-grid');
            const exportBtn = document.getElementById('export-btn');
            const exportFilename = document.getElementById('export-filename');
            const includeHeader = document.getElementById('include-header');
            const exampleBtn = document.getElementById('example-btn');
            const clearBtn = document.getElementById('clear-btn');
            const helpBtn = document.getElementById('help-btn');
            const helpModal = document.getElementById('help-modal');
            const closeHelp = document.getElementById('close-help');
            const notification = document.getElementById('notification');
            const notificationMessage = document.getElementById('notification-message');
            const notificationIcon = document.getElementById('notification-icon');
            
            // 初始化函数
            function init() {
                console.log('Sheetspeed已初始化');
                
                // 更新字符计数
                markdownInput.addEventListener('input', updateCharCount);
                updateCharCount();
                
                // 自动预览
                markdownInput.addEventListener('input', () => {
                    if (autoPreview.checked) {
                        previewTable();
                    }
                });
                
                // 预览按钮
                previewBtn.addEventListener('click', previewTable);
                
                // 可视化按钮
                visualizeBtn.addEventListener('click', createChart);
                
                // 导出按钮
                exportBtn.addEventListener('click', exportData);
                
                // 示例按钮
                exampleBtn.addEventListener('click', loadExample);
                
                // 清空按钮
                clearBtn.addEventListener('click', clearEditor);
                
                // 帮助按钮
                helpBtn.addEventListener('click', () => {
                    helpModal.classList.remove('hidden');
                });
                
                // 关闭帮助
                closeHelp.addEventListener('click', () => {
                    helpModal.classList.add('hidden');
                });
                
                // 点击帮助模态框外部关闭
                helpModal.addEventListener('click', (e) => {
                    if (e.target === helpModal) {
                        helpModal.classList.add('hidden');
                    }
                });
                
                // 初始化图表类型选择
                document.querySelectorAll('.chart-type-option').forEach(option => {
                    option.addEventListener('click', () => {
                        // 移除所有选中状态
                        document.querySelectorAll('.chart-type-option').forEach(opt => {
                            opt.classList.remove('btn-active');
                        });
                        
                        // 添加选中状态
                        option.classList.add('btn-active');
                    });
                });
                
                // 默认选中第一个图表类型
                document.querySelector('.chart-type-option').classList.add('btn-active');
                
                // 初始化主题选择
                document.querySelectorAll('.theme-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        // 移除所有选中状态
                        document.querySelectorAll('.theme-btn').forEach(b => {
                            b.classList.remove('ring-2', 'ring-offset-2', 'ring-primary');
                        });
                        
                        // 添加选中状态
                        btn.classList.add('ring-2', 'ring-offset-2', 'ring-primary');
                        
                        // 保存选中的主题
                        selectedTheme = btn.dataset.theme;
                    });
                });
                
                // 默认选中第一个颜色主题
                document.querySelector('.theme-btn').classList.add('ring-2', 'ring-offset-2', 'ring-primary');
                
                // 初始化导出选项
                document.querySelectorAll('.export-option').forEach(option => {
                    option.addEventListener('click', () => {
                        // 移除所有选中状态
                        document.querySelectorAll('.export-option').forEach(opt => {
                            opt.classList.remove('btn-active');
                        });
                        
                        // 添加选中状态
                        option.classList.add('btn-active');
                    });
                });
                
                // 平滑滚动
                document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                    anchor.addEventListener('click', function (e) {
                        e.preventDefault();
                        
                        const targetId = this.getAttribute('href');
                        const targetElement = document.querySelector(targetId);
                        
                        if (targetElement) {
                            window.scrollTo({
                                top: targetElement.offsetTop - 80,
                                behavior: 'smooth'
                            });
                        }
                    });
                });
                
                // 导航栏滚动效果
                window.addEventListener('scroll', () => {
                    if (window.scrollY > 10) {
                        document.getElementById('navbar').classList.add('shadow-md', 'bg-white/95', 'backdrop-blur-sm');
                    } else {
                        document.getElementById('navbar').classList.remove('shadow-md', 'bg-white/95', 'backdrop-blur-sm');
                    }
                });
            }
            
            // 更新字符计数
            function updateCharCount() {
                const count = markdownInput.value.length;
                charCount.textContent = `${count} 字符`;
            }
            
// 预览表格
function previewTable() {
    const markdown = markdownInput.value.trim();

    if (!markdown) {
        showNotification('警告', '请输入Markdown表格', 'warning');
        tablePreview.innerHTML = `
            <div class="opacity-50 text-center py-16">
                <i class="fa-solid fa-table text-4xl text-gray-300 mb-2"></i>
                <p class="text-gray-400">在此处预览您的表格</p>
            </div>`;
        return;
    }

    try {
        // 解析Markdown表格
        const html = marked.parse(markdown);

        // 检查是否包含表格
        if (!html.includes('<table>')) {
            showNotification('错误', '未找到有效的Markdown表格', 'error');
            tablePreview.innerHTML = `
                <div class="text-center py-16 text-red-500">
                    <i class="fa-solid fa-exclamation-triangle text-4xl mb-2"></i>
                    <p>未找到有效的Markdown表格</p>
                    <p class="text-sm mt-2 text-gray-500">请确保使用正确的Markdown表格语法</p>
                </div>`;
            return;
        }

        // 显示表格
        tablePreview.innerHTML = html;

        // 美化表格
        const table = tablePreview.querySelector('table');
        if (table) {
            table.className = 'min-w-full divide-y divide-gray-200';

            // 处理表头
            const thead = table.querySelector('thead');
            if (thead) {
                thead.className = 'bg-gray-100';

                const thElements = thead.querySelectorAll('th');
                thElements.forEach(th => {
                    th.className = 'px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider';
                });
            }

            // 处理表体
            const tbody = table.querySelector('tbody');
            if (tbody) {
                tbody.className = 'bg-white divide-y divide-gray-200';

                const trElements = tbody.querySelectorAll('tr');
                trElements.forEach((tr, index) => {
                    tr.className = index % 2 === 0 ? 'bg-gray-50' : 'bg-white';

                    const tdElements = tr.querySelectorAll('td');
                    tdElements.forEach(td => {
                        td.className = 'px-4 py-3 whitespace-nowrap text-sm text-gray-500';
                    });
                });
            }

            // 提取表格数据
            extractTableData(table);

            // 更新行列计数
            if (thead && tbody) {
                const cols = thead.querySelectorAll('th').length;
                const rows = tbody.querySelectorAll('tr').length;

                colsCount.textContent = cols;
                rowsCount.textContent = rows;

                // 更新下拉选择框
                updateColumnSelectors(tableData[0]);
            }
        }

        showNotification('成功', '表格预览更新成功', 'success');
    } catch (error) {
        console.error('预览表格时出错:', error);
        showNotification('错误', '解析Markdown表格时出错', 'error');
    }
}
            
            // 提取表格数据
            function extractTableData(table) {
                const data = [];
                const rows = table.querySelectorAll('tr');
                
                rows.forEach(row => {
                    const cells = [];
                    const cellsElements = row.querySelectorAll('th, td');
                    
                    cellsElements.forEach(cell => {
                        cells.push(cell.textContent.trim());
                    });
                    
                    data.push(cells);
                });
                
                tableData = data;
            }
            
            // 更新列选择器
            function updateColumnSelectors(headers) {
                // 清空现有选项
                xAxisSelect.innerHTML = '<option value="">请选择...</option>';
                yAxisSelect.innerHTML = '<option value="">请选择...</option>';
                
                // 添加新选项
                headers.forEach((header, index) => {
                    const option = document.createElement('option');
                    option.value = index;
                    option.textContent = header;
                    
                    // 克隆选项用于另一个选择器
                    const option2 = option.cloneNode(true);
                    
                    xAxisSelect.appendChild(option);
                    yAxisSelect.appendChild(option2);
                });
            }
            
            // 创建图表
            function createChart() {
                if (!tableData || tableData.length <= 1) {
                    showNotification('错误', '请先预览有效的表格数据', 'error');
                    return;
                }
                
                const xAxisIndex = parseInt(xAxisSelect.value);
                const yAxisIndex = parseInt(yAxisSelect.value);
                
                if (isNaN(xAxisIndex) || isNaN(yAxisIndex)) {
                    showNotification('错误', '请选择X轴和Y轴数据列', 'error');
                    return;
                }
                
                if (xAxisIndex === yAxisIndex) {
                    showNotification('错误', 'X轴和Y轴不能选择同一列', 'error');
                    return;
                }
                
                // 准备图表数据
                const labels = [];
                const values = [];
                
                // 从第2行开始，因为第1行是表头
                for (let i = 1; i < tableData.length; i++) {
                    // 跳过空行
                    if (!tableData[i][xAxisIndex] || !tableData[i][yAxisIndex]) continue;
                    
                    labels.push(tableData[i][xAxisIndex]);
                    
                    // 尝试转换为数字
                    const value = parseFloat(tableData[i][yAxisIndex]);
                    values.push(isNaN(value) ? tableData[i][yAxisIndex] : value);
                }
                
                if (labels.length === 0 || values.length === 0) {
                    showNotification('错误', '所选列中没有有效数据', 'error');
                    return;
                }
                
                // 获取选中的图表类型
                let chartType = 'bar';
                const selectedChartType = document.querySelector('.chart-type-option.btn-active');
                if (selectedChartType) {
                    chartType = selectedChartType.dataset.type;
                }
                
                // 如果已有图表，销毁它
                if (chart) {
                    chart.destroy();
                }
                
                // 显示图表容器
                chartContainer.classList.remove('hidden');
                noChartMessage.classList.add('hidden');
                
                // 准备图表配置
                const config = {
                    type: chartType,
                    data: {
                        labels: labels,
                        datasets: [{
                            label: chartTitle.value || tableData[0][yAxisIndex],
                            data: values,
                            backgroundColor: getThemeColors(labels.length),
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: showLegend.checked,
                                position: 'top',
                            },
                            title: {
                                display: true,
                                text: chartTitle.value || `${tableData[0][yAxisIndex]} 图表`,
                                font: {
                                    size: 16,
                                    weight: 'bold'
                                }
                            },
                            tooltip: {
                                mode: 'index',
                                intersect: false,
                                backgroundColor: 'rgba(255, 255, 255, 0.9)',
                                titleColor: '#1D2129',
                                bodyColor: '#4E5969',
                                borderColor: '#E5E6EB',
                                borderWidth: 1,
                                padding: 12,
                                boxPadding: 6,
                                usePointStyle: true,
                                callbacks: {
                                    label: function(context) {
                                        return `${tableData[0][yAxisIndex]}: ${context.raw}`;
                                    }
                                }
                            }
                        },
                        scales: {
                            x: {
                                grid: {
                                    display: showGrid.checked,
                                    color: 'rgba(0, 0, 0, 0.05)'
                                },
                                ticks: {
                                    color: '#4E5969'
                                }
                            },
                            y: {
                                grid: {
                                    display: showGrid.checked,
                                    color: 'rgba(0, 0, 0, 0.05)'
                                },
                                ticks: {
                                    color: '#4E5969',
                                    callback: function(value) {
                                        // 格式化大数字
                                        if (value >= 1000 && value < 1000000) {
                                            return (value / 1000).toFixed(1) + 'k';
                                        } else if (value >= 1000000) {
                                            return (value / 1000000).toFixed(1) + 'M';
                                        }
                                        return value;
                                    }
                                }
                            }
                        },
                        animations: {
                            tension: {
                                duration: 1000,
                                easing: 'linear'
                            }
                        }
                    }
                };
                
                // 特殊配置
                if (chartType === 'pie' || chartType === 'doughnut') {
                    delete config.options.scales;
                }
                
                // 创建图表
                chart = new Chart(chartCanvas, config);
                
                showNotification('成功', '图表创建成功', 'success');
            }
            
            // 获取主题颜色
            function getThemeColors(count) {
                const themes = {
                    blue: [
                        'rgba(22, 93, 255, 0.7)',
                        'rgba(66, 133, 244, 0.7)',
                        'rgba(128, 177, 239, 0.7)',
                        'rgba(189, 215, 238, 0.7)',
                        'rgba(229, 245, 249, 0.7)',
                        'rgba(113, 166, 232, 0.7)',
                        'rgba(52, 101, 164, 0.7)',
                        'rgba(3, 54, 107, 0.7)'
                    ],
                    green: [
                        'rgba(0, 191, 165, 0.7)',
                        'rgba(0, 150, 136, 0.7)',
                        'rgba(77, 182, 172, 0.7)',
                        'rgba(128, 203, 196, 0.7)',
                        'rgba(178, 223, 219, 0.7)',
                        'rgba(224, 242, 241, 0.7)',
                        'rgba(0, 105, 92, 0.7)',
                        'rgba(0, 77, 64, 0.7)'
                    ],
                    purple: [
                        'rgba(156, 39, 176, 0.7)',
                        'rgba(123, 31, 162, 0.7)',
                        'rgba(103, 58, 183, 0.7)',
                        'rgba(149, 117, 205, 0.7)',
                        'rgba(179, 157, 219, 0.7)',
                        'rgba(206, 181, 226, 0.7)',
                        'rgba(74, 20, 140, 0.7)',
                        'rgba(49, 27, 146, 0.7)'
                    ],
                    red: [
                        'rgba(244, 67, 54, 0.7)',
                        'rgba(233, 30, 99, 0.7)',
                        'rgba(220, 53, 69, 0.7)',
                        'rgba(234, 128, 252, 0.7)',
                        'rgba(240, 98, 146, 0.7)',
                        'rgba(248, 187, 208, 0.7)',
                        'rgba(183, 28, 28, 0.7)',
                        'rgba(123, 31, 162, 0.7)'
                    ],
                    yellow: [
                        'rgba(255, 193, 7, 0.7)',
                        'rgba(255, 152, 0, 0.7)',
                        'rgba(255, 235, 59, 0.7)',
                        'rgba(255, 215, 0, 0.7)',
                        'rgba(251, 192, 45, 0.7)',
                        'rgba(255, 241, 118, 0.7)',
                        'rgba(255, 179, 0, 0.7)',
                        'rgba(255, 143, 0, 0.7)'
                    ],
                    gray: [
                        'rgba(158, 158, 158, 0.7)',
                        'rgba(117, 117, 117, 0.7)',
                        'rgba(96, 125, 139, 0.7)',
                        'rgba(120, 144, 156, 0.7)',
                        'rgba(144, 164, 174, 0.7)',
                        'rgba(189, 189, 189, 0.7)',
                        'rgba(66, 66, 66, 0.7)',
                        'rgba(33, 33, 33, 0.7)'
                    ]
                };
                
                // 如果颜色数量不够，循环使用
                const colors = themes[selectedTheme];
                const result = [];
                
                for (let i = 0; i < count; i++) {
                    result.push(colors[i % colors.length]);
                }
                
                return result;
            }
            
            // 导出数据
            function exportData() {
                if (!tableData || tableData.length <= 1) {
                    showNotification('错误', '请先预览有效的表格数据', 'error');
                    return;
                }
                
                try {
                    // 获取选中的导出格式
                    let format = 'xlsx';
                    const selectedFormat = document.querySelector('.export-option.btn-active');
                    if (selectedFormat) {
                        format = selectedFormat.dataset.format;
                    }
                    
                    // 获取文件名
                    let filename = exportFilename.value.trim() || 'table-data';
                    if (!filename.endsWith(`.${format}`)) {
                        filename += `.${format}`;
                    }
                    
                    // 准备导出数据
                    let exportData = tableData;
                    
                    // 如果不包含表头
                    if (!includeHeader.checked && exportData.length > 0) {
                        exportData = exportData.slice(1);
                    }
                    
                    // 根据格式导出
                    switch (format) {
                        case 'xlsx':
                            exportToExcel(exportData, filename);
                            break;
                        case 'csv':
                            exportToCSV(exportData, filename);
                            break;
                        case 'markdown':
                            exportToMarkdown(exportData, filename);
                            break;
                        case 'json':
                            exportToJSON(exportData, filename);
                            break;
                        default:
                            showNotification('错误', '不支持的导出格式', 'error');
                    }
                } catch (error) {
                    console.error('导出数据时出错:', error);
                    showNotification('错误', '导出数据时出错', 'error');
                }
            }
            
            // 导出到Excel
            function exportToExcel(data, filename) {
                // 创建工作簿和工作表
                const wb = XLSX.utils.book_new();
                const ws = XLSX.utils.aoa_to_sheet(data);
                
                // 将工作表添加到工作簿
                XLSX.utils.book_append_sheet(wb, ws, "表格数据");
                
                // 设置列宽
                const wscols = data[0].map(() => ({wch: 20}));
                ws['!cols'] = wscols;
                
                // 导出Excel文件
                XLSX.writeFile(wb, filename);
                
                showNotification('成功', `Excel文件已导出为 "${filename}"`, 'success');
            }
            
            // 导出到CSV
            function exportToCSV(data, filename) {
                // 转换为CSV格式
                const csvContent = data.map(row => 
                    row.map(cell => {
                        // 处理包含逗号或引号的单元格
                        if (cell.includes(',') || cell.includes('"') || cell.includes('\n')) {
                            return `"${cell.replace(/"/g, '""')}"`;
                        }
                        return cell;
                    }).join(',')
                ).join('\n');
                
                // 创建Blob并下载
                const blob = new Blob([csvContent], {type: 'text/csv;charset=utf-8;'});
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.setAttribute('href', url);
                link.setAttribute('target', '_blank');
                link.setAttribute('download', filename);
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                showNotification('成功', `CSV文件已导出为 "${filename}"`, 'success');
            }
            
            // 导出到Markdown
            function exportToMarkdown(data, filename) {
                if (data.length === 0) return;
                
                // 构建Markdown表格
                let markdown = '';
                
                // 添加表头行
                markdown += `| ${data[0].join(' | ')} |\n`;
                
                // 添加分隔行
                markdown += `|${data[0].map(() => ' --- ').join('|')}|\n`;
                
                // 添加数据行
                for (let i = 1; i < data.length; i++) {
                    markdown += `| ${data[i].join(' | ')} |\n`;
                }
                
                // 创建Blob并下载
                const blob = new Blob([markdown], {type: 'text/markdown;charset=utf-8;'});
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.setAttribute('href', url);
                link.setAttribute('target', '_blank');
                link.setAttribute('download', filename);
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                showNotification('成功', `Markdown文件已导出为 "${filename}"`, 'success');
            }
            
            // 导出到JSON
            function exportToJSON(data, filename) {
                if (data.length <= 1) return;
                
                // 转换为JSON对象数组
                const headers = data[0];
                const jsonData = data.slice(1).map(row => {
                    const obj = {};
                    headers.forEach((header, index) => {
                        obj[header] = row[index];
                    });
                    return obj;
                });
                
                // 转换为JSON字符串
                const jsonString = JSON.stringify(jsonData, null, 2);
                
                // 创建Blob并下载
                const blob = new Blob([jsonString], {type: 'application/json;charset=utf-8;'});
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.setAttribute('href', url);
                link.setAttribute('target', '_blank');
                link.setAttribute('download', filename);
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                showNotification('成功', `JSON文件已导出为 "${filename}"`, 'success');
            }
            
            // 加载示例表格
            function loadExample() {
                const example = `| 产品   | 价格（元） | 销量 | 增长率 |
|--------|------------|------|--------|
| 产品A  | 199        | 1200 | 12.5%  |
| 产品B  | 299        | 850  | 8.3%   |
| 产品C  | 399        | 520  | 15.7%  |
| 产品D  | 499        | 380  | 9.2%   |
| 产品E  | 599        | 270  | 6.8%   |`;
                
                markdownInput.value = example;
                updateCharCount();
                
                if (autoPreview.checked) {
                    previewTable();
                }
                
                showNotification('提示', '已加载示例表格', 'info');
            }
            
            // 清空编辑器
            function clearEditor() {
                if (confirm('确定要清空编辑器内容吗？')) {
                    markdownInput.value = '';
                    updateCharCount();
                    tablePreview.innerHTML = `
                        <div class="opacity-50 text-center py-16">
                            <i class="fa-solid fa-table text-4xl text-gray-300 mb-2"></i>
                            <p class="text-gray-400">在此处预览您的表格</p>
                        </div>`;
                    
                    rowsCount.textContent = '0';
                    colsCount.textContent = '0';
                    
                    xAxisSelect.innerHTML = '<option value="">请选择...</option>';
                    yAxisSelect.innerHTML = '<option value="">请选择...</option>';
                    
                    // 隐藏图表
                    if (chart) {
                        chart.destroy();
                        chart = null;
                    }
                    
                    chartContainer.classList.add('hidden');
                    noChartMessage.classList.remove('hidden');
                    
                    showNotification('成功', '编辑器已清空', 'success');
                }
            }
            
            // 显示通知
            function showNotification(title, message, type) {
                notificationMessage.textContent = `${title}: ${message}`;
                
                // 设置图标和样式
                if (type === 'success') {
                    notification.className = 'fixed top-4 right-4 p-4 rounded-lg shadow-lg transform transition-all duration-300 translate-x-0 opacity-100 z-50 flex items-center bg-green-50 text-green-800 border-l-4 border-green-400';
                    notificationIcon.className = 'fa-solid fa-check-circle text-green-500 mr-2';
                } else if (type === 'error') {
                    notification.className = 'fixed top-4 right-4 p-4 rounded-lg shadow-lg transform transition-all duration-300 translate-x-0 opacity-100 z-50 flex items-center bg-red-50 text-red-800 border-l-4 border-red-400';
                    notificationIcon.className = 'fa-solid fa-exclamation-circle text-red-500 mr-2';
                } else if (type === 'warning') {
                    notification.className = 'fixed top-4 right-4 p-4 rounded-lg shadow-lg transform transition-all duration-300 translate-x-0 opacity-100 z-50 flex items-center bg-yellow-50 text-yellow-800 border-l-4 border-yellow-400';
                    notificationIcon.className = 'fa-solid fa-exclamation-triangle text-yellow-500 mr-2';
                } else if (type === 'info') {
                    notification.className = 'fixed top-4 right-4 p-4 rounded-lg shadow-lg transform transition-all duration-300 translate-x-0 opacity-100 z-50 flex items-center bg-blue-50 text-blue-800 border-l-4 border-blue-400';
                    notificationIcon.className = 'fa-solid fa-info-circle text-blue-500 mr-2';
                }
                
                // 显示通知
                notification.style.transform = 'translateX(0)';
                notification.style.opacity = '1';
                
                // 3秒后隐藏通知
                setTimeout(() => {
                    notification.style.transform = 'translateX(calc(100% + 1rem))';
                    notification.style.opacity = '0';
                }, 3000);
            }
            
            // 页面加载完成后初始化
            document.addEventListener('DOMContentLoaded', init);
        </script>
    </body></html>
    